@{
    ViewBag.Title = "No Access";
}

<h2>Sorry ,you do not have access to this page.</h2>
<h5>Please contact with your administrator.</h5>

<script src="~/lib/paho-mqtt.min.js"></script>

<script>

    document.addEventListener("DOMContentLoaded", function () {
        // MQTT Broker的WebSocket地址
        const host = "cnwuxg0te01";
        const port = 8084;
        const path = "";  // 如果有特定的 path，填写在这里

        // 创建客户端实例
        const client = new Paho.MQTT.Client(host, Number(port), path, "clientId");

        // 设置连接选项
        const options = {
            useSSL: true,  // 使用 WebSocket Secure
            userName: "",  // 如果有用户名，请填写
            password: "",  // 如果有密码，请填写
            onSuccess: onConnect,
            onFailure: onFailure
        };

        // 连接到 MQTT Broker
        client.connect(options);

        // 连接成功时的回调函数
        function onConnect() {
            console.log("Connected to MQTT broker");

            // 订阅主题
            const topic = "machine/11/updates";
            client.subscribe(topic);
            console.log(`Subscribed to topic: ${topic}`);
        }

        // 连接失败时的回调函数
        function onFailure(error) {
            console.error("Connection failed:", error);
        }

        // 收到消息时的回调函数
        client.onMessageArrived = function (message) {
            console.log(`Received message: ${message.payloadString} on topic: ${message.destinationName}`);
        };

        // 处理连接断开事件
        client.onConnectionLost = function (responseObject) {
            if (responseObject.errorCode !== 0) {
                console.error("Connection lost:", responseObject.errorMessage);
            }
        };
    });
</script>